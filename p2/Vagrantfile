# p2/Vagrantfile
# P2 - K3s and three simple applications (single VM) [file:1]

Vagrant.configure("2") do |config|
  # Use a box that exists and you already added for libvirt. [web:212]
  config.vm.box = "bento/ubuntu-24.04"
  config.ssh.insert_key = false

  config.vm.define "alrahmouS" do |srv|
    srv.vm.hostname = "alrahmouS" # login + "S" [file:1]

    # Required IP for Part 2 requests is 192.168.56.110. [file:1]
    # Pin to your libvirt network 'iot56' (192.168.56.0/24). [web:100]
    srv.vm.network "private_network",
      ip: "192.168.56.110",
      libvirt__network_name: "iot56",
      libvirt__netmask: "255.255.255.0"

    srv.vm.provider :libvirt do |v|
      v.cpus   = 1
      v.memory = 1024
    end

    srv.vm.provision "shell",
      path: "scripts/install_k3s.sh",
      env: {
        "SERVER_IP" => "192.168.56.110"
      }
  end
end
